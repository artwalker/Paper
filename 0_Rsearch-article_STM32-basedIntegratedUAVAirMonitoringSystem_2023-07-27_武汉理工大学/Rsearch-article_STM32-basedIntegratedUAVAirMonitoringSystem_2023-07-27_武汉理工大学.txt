STM32-based Integrated UAV Air Monitoring System 
Qihan Zhaoâˆ— Wuhan University of Technology, Wuhan, China Pengbo Zhang Wuhan University of Technology, Wuhan, China Yong Chen Wuhan University of Technology, Wuhan, China 

ABSTRACT 
With the increasing severity of air pollution, it has become an urgent problem to conduct large-scale targeted detection of various evaluation indexes of air pollution degree.
Based on the current status of air monitoring, this paper designs an integrated UAV air monitoring system based on STM32 by combining UAV technology with integrated MCU sensing and detection technology with high mobility and wide coverage.
It can not only realize real-time air quality detection, but also reduce the cost and time of air detection.
At the same time, the evaluation index can be sampled from the three-dimensional space, which has the advantages of fast sampling speed, good timeliness and high stability.
åŸºäºSTM32çš„é›†æˆæ— äººæœºç©ºæ°”ç›‘æµ‹ç³»ç»Ÿ

æ‘˜è¦ï¼šéšç€ç©ºæ°”æ±¡æŸ“çš„æ—¥ç›Šä¸¥é‡ï¼Œæœ‰å¿…è¦å¯¹ç©ºæ°”æ±¡æŸ“ç¨‹åº¦çš„å„ç§è¯„ä¼°æŒ‡æ ‡è¿›è¡Œå¤§è§„æ¨¡çš„æœ‰é’ˆå¯¹æ€§æ£€æµ‹ã€‚
æœ¬æ–‡åŸºäºå½“å‰ç©ºæ°”ç›‘æµ‹çš„ç°çŠ¶ï¼Œç»“åˆæ— äººæœºæŠ€æœ¯å’Œé›†æˆMCUæ„ŸçŸ¥ä¸æ£€æµ‹æŠ€æœ¯çš„é«˜æœºåŠ¨æ€§ä¸å¹¿è¦†ç›–æ€§ï¼Œè®¾è®¡äº†ä¸€ç§åŸºäºSTM32çš„é›†æˆæ— äººæœºç©ºæ°”ç›‘æµ‹ç³»ç»Ÿã€‚
è¯¥ç³»ç»Ÿä¸ä»…å¯ä»¥å®ç°å®æ—¶ç©ºæ°”è´¨é‡æ£€æµ‹ï¼Œè¿˜å¯ä»¥é™ä½ç©ºæ°”æ£€æµ‹çš„æˆæœ¬å’Œæ—¶é—´ã€‚
åŒæ—¶ï¼Œè¯¥ç³»ç»Ÿå¯ä»¥ä»ä¸‰ç»´ç©ºé—´ä¸­é‡‡æ ·è¯„ä¼°æŒ‡æ ‡ï¼Œå…·æœ‰å¿«é€Ÿé‡‡æ ·é€Ÿåº¦ã€è‰¯å¥½çš„æ—¶æ•ˆæ€§å’Œé«˜ç¨³å®šæ€§çš„ä¼˜ç‚¹ã€‚

CCS CONCEPTS 
â€¢ Computer systems organization â†’ Embedded and cyber- physical systems; Sensor networks.

KEYWORDS 
Air monitoring, STM32, Sensing detection, AD conversion, PID 

ACM Reference Format: Qihan Zhao, Pengbo Zhang, and Yong Chen.2023.
STM32-based Integrated UAV Air Monitoring System.
In 2023 4th International Conference on Comput- ing, Networks and Internet of Things (CNIOT â€™23), May 26â€“28, 2023, Xiamen, China.
ACM, New York, NY, USA, 5 pages.
https://doi.org/10.1145/3603781.3603921 

1 INTRODUCTION In recent years, with the rapid development of our national econ- omy, air pollution has become a serious problem that all countries must face.
It has become an important technical problem that all the indicators of the degree of air pollution are tested in stereo- scale.
Along with the industrial exhaust emissions, the air nitrogen, sulfide and other corrosive gases and particulate matter content is increasing [1].

CCS CONCEPTS â€¢ è®¡ç®—æœºç³»ç»Ÿç»„ç»‡ â†’ åµŒå…¥å¼å’Œç‰©ç†ç½‘ç»œç³»ç»Ÿï¼›ä¼ æ„Ÿå™¨ç½‘ç»œã€‚

å…³é”®è¯ 
ç©ºæ°”ç›‘æµ‹ï¼ŒSTM32ï¼Œä¼ æ„Ÿæ£€æµ‹ï¼ŒADè½¬æ¢ï¼ŒPID 
ACMå‚è€ƒæ ¼å¼ï¼šèµµçªæ¶µï¼Œå¼ é¹æ³¢å’Œé™ˆå‹‡ã€‚2023å¹´ã€‚
åŸºäºSTM32çš„é›†æˆæ— äººæœºç©ºæ°”ç›‘æµ‹ç³»ç»Ÿã€‚
åœ¨2023å¹´ç¬¬å››å±Šè®¡ç®—åŒ–ï¼Œç½‘ç»œå’Œç‰©è”ç½‘å›½é™…ä¼šè®®ï¼ˆCNIOT'23ï¼‰ä¸­ï¼Œ2023å¹´5æœˆ26æ—¥è‡³28æ—¥ï¼Œä¸­å›½å¦é—¨ä¸¾è¡Œã€‚
ACMï¼Œç¾å›½çº½çº¦ï¼Œçº½çº¦ï¼Œ5é¡µã€‚
https://doi.org/10.1145/3603781.3603921 

1 å¼•è¨€ è¿‘å¹´æ¥ï¼Œéšç€æˆ‘å›½ç»æµçš„å¿«é€Ÿå‘å±•ï¼Œç©ºæ°”æ±¡æŸ“å·²æˆä¸ºå„å›½å¿…é¡»é¢ä¸´çš„ä¸¥é‡é—®é¢˜ã€‚
å®ƒå·²æˆä¸ºæ‰€æœ‰ç©ºæ°”æ±¡æŸ“ç¨‹åº¦æŒ‡æ ‡è¢«ç«‹ä½“æµ‹è¯•çš„é‡è¦æŠ€æœ¯é—®é¢˜ã€‚
éšç€å·¥ä¸šæ’æ”¾ç‰©çš„æ’æ”¾ï¼Œç©ºæ°”ä¸­çš„æ°®æ°”ã€ç¡«åŒ–ç‰©å’Œå…¶ä»–è…èš€æ€§æ°”ä½“ä»¥åŠé¢—ç²’ç‰©å«é‡æ­£åœ¨å¢åŠ [1]ã€‚

The main sources of air pollutants are industrial emissions, winter heating emissions, motor vehicle exhaust emis- sions, dust weather, construction dust, etc.
The total concentration of pollutants in the north is higher than that in the south, and the content of pollutants varies with different regions and seasons.

âˆ—Corresponding author: z2993737597@163.com 
Permission to make digital or hard copies of all or part of this work for personal or classroom use is granted without fee provided that copies are not made or distributed for profit or commercial advantage and that copies bear this notice and the full citation on the first page.
Copyrights for components of this work owned by others than the author(s) must be honored.
Abstracting with credit is permitted.
To copy otherwise, or republish, to post on servers or to redistribute to lists, requires prior specific permission and/or a fee.
Request permissions from permissions@acm.org.
ä¸»è¦çš„ç©ºæ°”æ±¡æŸ“ç‰©æºåŒ…æ‹¬å·¥ä¸šæ’æ”¾ã€å†¬å­£ä¾›æš–æ’æ”¾ã€æœºåŠ¨è½¦å°¾æ°”æ’æ”¾ã€æ²™å°˜å¤©æ°”ã€å»ºç­‘æ‰¬å°˜ç­‰ã€‚
åŒ—æ–¹çš„æ±¡æŸ“ç‰©æ€»æµ“åº¦é«˜äºå—æ–¹ï¼Œæ±¡æŸ“ç‰©å«é‡åœ¨ä¸åŒåœ°åŒºå’Œå­£èŠ‚ä¹Ÿæœ‰æ‰€ä¸åŒã€‚

å…è®¸ä¸ªäººæˆ–è¯¾å ‚ä½¿ç”¨ï¼Œå¯ä»¥åˆ¶ä½œæˆ–åˆ†å‘æ•°å­—æˆ–çº¸è´¨å‰¯æœ¬ï¼Œä½†ä¸å¾—ç”¨äºç›ˆåˆ©æˆ–å•†ä¸šä¼˜åŠ¿ï¼Œå¹¶ä¸”å‰¯æœ¬å¿…é¡»å¸¦æœ‰æœ¬é€šçŸ¥åŠåœ¨ç¬¬ä¸€é¡µä¸Šçš„å…¨æ–‡å¼•ç”¨ã€‚
å¯¹äºæœ¬ä½œå“ä¸­å…¶ä»–ä½œè€…æ‹¥æœ‰ç‰ˆæƒçš„éƒ¨åˆ†ï¼Œå¿…é¡»äºˆä»¥å°Šé‡ã€‚
å…è®¸å¸¦æœ‰ç½²åçš„æ‘˜è¦ã€‚
å¦‚æœè¦è¿›è¡Œå¤åˆ¶ã€å†å‡ºç‰ˆã€åœ¨æœåŠ¡å™¨ä¸Šå‘å¸ƒæˆ–é‡æ–°åˆ†å‘ç»™åˆ—è¡¨ï¼Œéœ€è¦äº‹å…ˆè·å¾—æ˜ç¡®çš„è®¸å¯å’Œ/æˆ–æ”¯ä»˜è´¹ç”¨ã€‚
è¯·å‘permissions@acm.orgç”³è¯·æƒé™ã€‚

CNIOT â€™23, May 26â€“28, 2023, Xiamen, China 
Â© 2023 Copyright held by the owner/author(s).
Publication rights licensed to ACM.
ACM ISBN 979-8-4007-0070-5/23/05...$15.00 
https://doi.org/10.1145/3603781.3603921 

During winter heating, the concentration of PM10, PM2.5 and SO2 rose sharply due to the increase of coal burning in the Figure 1.
At present, the air monitoring mainly includes portable man- ual detection device, fixed point base station detection and mobile monitoring points.
However, the above three methods are mainly aimed at the air monitoring at lower levels.
At the same time, they fluctuate greatly under the influence of environment and have low detection stability.
Therefore, they cannot complete the overall de- tection of regional air.
Currently, there are few sampling ports for the peripherals of air testing instruments, and only one kind of pollution gas is used for detection.

CNIOT'23ï¼Œ2023å¹´5æœˆ26æ—¥è‡³28æ—¥ï¼Œä¸­å›½å¦é—¨ï¼Œ
ç‰ˆæƒæ‰€æœ‰Â©2023å¹´ï¼Œç‰ˆæƒæ‰€æœ‰è€…/ä½œè€…ã€‚
å‡ºç‰ˆæƒå·²æˆæƒACMã€‚
ACM ISBN 979-8-4007-0070-5/23/05ã€‚...15.00ç¾å…ƒã€‚
https://doi.org/10.1145/3603781.3603921

åœ¨å†¬å­£ä¾›æš–æœŸé—´ï¼Œç”±äºç…¤ç‡ƒçƒ§çš„å¢åŠ ï¼ŒPM10ã€PM2.5å’ŒSO2çš„æµ“åº¦æ€¥å‰§ä¸Šå‡ï¼Œå¦‚å›¾1æ‰€ç¤ºã€‚
ç›®å‰ï¼Œç©ºæ°”ç›‘æµ‹ä¸»è¦åŒ…æ‹¬ä¾¿æºå¼æ‰‹åŠ¨æ£€æµ‹è®¾å¤‡ã€å›ºå®šç‚¹åŸºç«™æ£€æµ‹å’Œç§»åŠ¨ç›‘æµ‹ç‚¹ã€‚
ç„¶è€Œï¼Œä¸Šè¿°ä¸‰ç§æ–¹æ³•ä¸»è¦é’ˆå¯¹ä½å±‚æ¬¡çš„ç©ºæ°”ç›‘æµ‹ï¼ŒåŒæ—¶å—ç¯å¢ƒå½±å“æ³¢åŠ¨å¾ˆå¤§ï¼Œæ£€æµ‹ç¨³å®šæ€§è¾ƒä½ã€‚
å› æ­¤ï¼Œå®ƒä»¬æ— æ³•å®ŒæˆåŒºåŸŸç©ºæ°”çš„æ•´ä½“æ£€æµ‹ã€‚
ç›®å‰ï¼Œç©ºæ°”æµ‹è¯•ä»ªå™¨å¤–å›´çš„å–æ ·å£å¾ˆå°‘ï¼Œå¹¶ä¸”åªèƒ½ç”¨äºæ£€æµ‹ä¸€ç§æ±¡æŸ“æ°”ä½“ã€‚

Therefore, comprehensive detec- tion of a wide range of various air pollution substances cannot be completed, and the flexibility is poor [2].
Therefore, an integrated air detection system with high flexibility, wide coverage and strong mobility is urgently needed to solve the problem of increasingly se- rious air pollution.
In 2014, EDC developed a HIM-6000 instrument that can simultaneously detect multiple gas contents.
By setting dual detection ports, it uses replaceable external sensing probes to detect multiple pollution gases.
In 2018, Yichang Company devel- oped SEM2000-M UAV environmental detection platform, which combines the remote sensing technology of UAV for emergency detection and air pollution detection.
The environmental detection platform is equipped with wireless communication module to transmit detection data in real time to complete monitoring.
å› æ­¤ï¼Œæ— æ³•å®Œæˆå¯¹å„ç§ç©ºæ°”æ±¡æŸ“ç‰©çš„å…¨é¢æ£€æµ‹ï¼Œå¹¶ä¸”å¼¹æ€§å·®[2]ã€‚
å› æ­¤ï¼Œè¿«åˆ‡éœ€è¦ä¸€ç§å…·æœ‰é«˜åº¦çµæ´»æ€§ã€å¹¿æ³›è¦†ç›–èŒƒå›´å’Œå¼ºå¤§æœºåŠ¨æ€§çš„ç»¼åˆç©ºæ°”æ£€æµ‹ç³»ç»Ÿæ¥è§£å†³æ—¥ç›Šä¸¥é‡çš„ç©ºæ°”æ±¡æŸ“é—®é¢˜ã€‚
2014å¹´ï¼ŒEDCå¼€å‘äº†ä¸€ç§åä¸ºHIM-6000çš„ä»ªå™¨ï¼Œå¯ä»¥åŒæ—¶æ£€æµ‹å¤šç§æ°”ä½“æˆåˆ†ã€‚
é€šè¿‡è®¾ç½®åŒé‡æ£€æµ‹ç«¯å£ï¼Œå®ƒä½¿ç”¨å¯æ›´æ¢çš„å¤–éƒ¨ä¼ æ„Ÿæ¢å¤´æ¥æ£€æµ‹å¤šç§æ±¡æŸ“æ°”ä½“ã€‚
2018å¹´ï¼Œå®œæ˜Œå…¬å¸å¼€å‘äº†SEM2000-M UAVç¯å¢ƒæ£€æµ‹å¹³å°ï¼Œç»“åˆäº†æ— äººæœºçš„é¥æ„ŸæŠ€æœ¯è¿›è¡Œç´§æ€¥æ£€æµ‹å’Œç©ºæ°”æ±¡æŸ“æ£€æµ‹ã€‚
è¯¥ç¯å¢ƒæ£€æµ‹å¹³å°é…å¤‡äº†æ— çº¿é€šä¿¡æ¨¡å—ï¼Œå®æ—¶ä¼ è¾“æ£€æµ‹æ•°æ®ä»¥å®Œæˆç›‘æµ‹ã€‚

In 2019, a team at the University of Barcelona developed a nanocrafter equipped with an air probe that can detect indoor air through au- tonomous navigation [3-4].
Based on the above status quo, a comprehensive air monitoring system based on STM32 is designed in this paper.
Time division multiplexing transmission of various sensors is realized through single-chip peripheral IO port, and the air quality detection system installed on UAV is adopted.
Compared with traditional air detection methods, the system can collect the air quality of any point in three- dimensional space [5].
The spatial distribution characteristics of pollutants can be analyzed more comprehensively, accurately and conveniently.
In terms of sensors, the sensor module is used to sample the main indicators of air pollutants.
2019å¹´ï¼Œå·´å¡ç½—é‚£å¤§å­¦çš„ä¸€ä¸ªå›¢é˜Ÿå¼€å‘äº†ä¸€ç§è£…å¤‡æœ‰ç©ºæ°”æ¢é’ˆçš„çº³ç±³åˆ¶é€ è€…ï¼Œèƒ½å¤Ÿé€šè¿‡è‡ªä¸»å¯¼èˆªæ£€æµ‹å®¤å†…ç©ºæ°”[3-4]ã€‚
åŸºäºä¸Šè¿°ç°çŠ¶ï¼Œæœ¬æ–‡è®¾è®¡äº†ä¸€ç§åŸºäºSTM32çš„ç»¼åˆç©ºæ°”ç›‘æµ‹ç³»ç»Ÿã€‚
é€šè¿‡å•ç‰‡æœºå¤–è®¾IOå£å®ç°å„ç§ä¼ æ„Ÿå™¨çš„æ—¶åˆ†å¤ç”¨ä¼ è¾“ï¼Œå¹¶é‡‡ç”¨å®‰è£…åœ¨æ— äººæœºä¸Šçš„ç©ºæ°”è´¨é‡æ£€æµ‹ç³»ç»Ÿã€‚
ä¸ä¼ ç»Ÿçš„ç©ºæ°”æ£€æµ‹æ–¹æ³•ç›¸æ¯”ï¼Œè¯¥ç³»ç»Ÿå¯ä»¥æ”¶é›†ä¸‰ç»´ç©ºé—´ä¸­ä»»æ„ç‚¹çš„ç©ºæ°”è´¨é‡[5]ã€‚
æ±¡æŸ“ç‰©çš„ç©ºé—´åˆ†å¸ƒç‰¹å¾å¯ä»¥æ›´å…¨é¢ã€å‡†ç¡®ã€æ–¹ä¾¿åœ°è¿›è¡Œåˆ†æã€‚
åœ¨ä¼ æ„Ÿå™¨æ–¹é¢ï¼Œä¼ æ„Ÿå™¨æ¨¡å—ç”¨äºé‡‡æ ·ç©ºæ°”æ±¡æŸ“ç‰©çš„ä¸»è¦æŒ‡æ ‡ã€‚

Figure 1: Picture the air pollution situation 

2 MONITORING SYSTEM DESIGN SCHEME 
The integrated UAV air monitoring system based on STM32 mainly detects air pollution at different heights in real time and dynamically, and transmits the collected data of different evaluation indictors to the signal receiving end through the wireless transmission system.
The system realizes the remote control real-time detection and dynamic display of different indicators of air monitoring values.
At the same time, the attitude of the UAV is monitored and data is collected through the gyroscope sensor set by the system.
The attitude of the UAV is obtained and the self-attitude adjustment can ensure the stable operation of the device.
The following figure shows the schematic diagram of the monitoring system, which is mainly composed of the main control module, attitude sensing module, integrated sensing module and wireless communication module [6].

788 CNIOT â€™23, May 26â€“28, 2023, Xiamen, China Qihan Zhao et al.

2 ç›‘æµ‹ç³»ç»Ÿè®¾è®¡æ–¹æ¡ˆ
åŸºäºSTM32çš„ç»¼åˆæ— äººæœºç©ºæ°”ç›‘æµ‹ç³»ç»Ÿä¸»è¦å®æ—¶ã€åŠ¨æ€åœ°æ£€æµ‹ä¸åŒé«˜åº¦çš„ç©ºæ°”æ±¡æŸ“ï¼Œå¹¶é€šè¿‡æ— çº¿ä¼ è¾“ç³»ç»Ÿå°†ä¸åŒè¯„ä¼°æŒ‡æ ‡çš„æ”¶é›†æ•°æ®ä¼ è¾“åˆ°ä¿¡å·æ¥æ”¶ç«¯ã€‚
è¯¥ç³»ç»Ÿå®ç°äº†å¯¹ç©ºæ°”ç›‘æµ‹æ•°å€¼çš„ä¸åŒæŒ‡æ ‡çš„è¿œç¨‹æ§åˆ¶å®æ—¶æ£€æµ‹å’ŒåŠ¨æ€æ˜¾ç¤ºã€‚
åŒæ—¶ï¼Œé€šè¿‡ç³»ç»Ÿè®¾ç½®çš„é™€èºä»ªä¼ æ„Ÿå™¨ç›‘æµ‹å¹¶æ”¶é›†æ— äººæœºå§¿æ€æ•°æ®ã€‚
è·å–æ— äººæœºçš„å§¿æ€å¹¶è¿›è¡Œè‡ªèº«å§¿æ€è°ƒæ•´ï¼Œä»¥ç¡®ä¿è®¾å¤‡çš„ç¨³å®šè¿è¡Œã€‚
ä»¥ä¸‹å›¾ç¤ºä¸ºç›‘æµ‹ç³»ç»Ÿçš„æ¡†å›¾ï¼Œä¸»è¦ç”±ä¸»æ§æ¨¡å—ã€å§¿æ€æ„ŸçŸ¥æ¨¡å—ã€ç»¼åˆæ„ŸçŸ¥æ¨¡å—å’Œæ— çº¿é€šä¿¡æ¨¡å—ç»„æˆ[6]ã€‚

Its monitoring system mainly includes the following parts: 
â€¢ Main control module: mainly coordinates all modules of the whole system, accepts analog signals transmitted by different sampling modules for AD conversion, and controls the operation of the overall device to adjust the attitude of the UAV; 
â€¢ Attitude detection and adjustment module: the current operating status of the UAV is obtained mainly through real-time signal detection of the UAV, and PWM wave generated by the main control module is accepted and adjusted by the control device to achieve the purpose of stabilizing the operation of the device; 
â€¢ Integrated sensing module: It carries out cyclic sampling of a variety of pollution gases including PM2.5 through built-in high-frequency sampling, in which time division multiplexing technology is adopted to solve the occupation problem of STM32 parallel port.
å…¶ç›‘æ§ç³»ç»Ÿä¸»è¦åŒ…æ‹¬ä»¥ä¸‹éƒ¨åˆ†ï¼š
â€¢ ä¸»æ§æ¨¡å—ï¼šä¸»è¦åè°ƒæ•´ä¸ªç³»ç»Ÿçš„æ‰€æœ‰æ¨¡å—ï¼Œæ¥å—ä¸åŒé‡‡æ ·æ¨¡å—ä¼ è¾“çš„æ¨¡æ‹Ÿä¿¡å·è¿›è¡ŒADè½¬æ¢ï¼Œå¹¶æ§åˆ¶æ•´ä¸ªè®¾å¤‡çš„è¿è¡Œï¼Œè°ƒèŠ‚æ— äººæœºçš„å§¿æ€ï¼›
â€¢ å§¿æ€æ£€æµ‹å’Œè°ƒèŠ‚æ¨¡å—ï¼šé€šè¿‡å¯¹æ— äººæœºçš„å®æ—¶ä¿¡å·æ£€æµ‹ï¼Œä¸»æ§æ¨¡å—ç”Ÿæˆçš„PWMæ³¢è¢«æ§åˆ¶è£…ç½®æ¥å—å’Œè°ƒèŠ‚ï¼Œä»¥å®ç°è®¾å¤‡è¿è¡Œçš„ç¨³å®šï¼›
â€¢ ç»¼åˆä¼ æ„Ÿæ¨¡å—ï¼šé€šè¿‡å†…ç½®çš„é«˜é¢‘é‡‡æ ·ï¼Œå¯¹åŒ…æ‹¬PM2.5åœ¨å†…çš„å„ç§æ±¡æŸ“æ°”ä½“è¿›è¡Œå¾ªç¯é‡‡æ ·ï¼Œé‡‡ç”¨æ—¶åˆ†å¤ç”¨æŠ€æœ¯è§£å†³äº†STM32å¹¶è¡Œæ¥å£å ç”¨çš„é—®é¢˜ã€‚

Design When the UAV is used to monitor the air in the area block, the multi-sensor module will sample the gas in it, and the signal processing module will carry out AD conversion and serial communication input, so as to carry out data analysis and processing of the component data [7].
The converted digital signal will be uploaded to the system terminal through the wireless communication module, and the terminal will realize data reception and analysis and processing.

3 HARDWARE DESIGN SCHEME 
The hardware part of the design mainly includes the microcontroller main control module, integrated sensing module, attitude sensing module.
Which is controlled by STM32 as the main control, the control system of the multi-dimensional sensor signal acquisition, the sensor to the air for high-frequency sampling, which in view of the air signal needs to be monitored in real time, need to ensure that the sensor module and AD module signal transmission of the same frequency, to achieve efficient signal at [8-9].
è®¾è®¡å½“æ— äººæœºç”¨äºç›‘æµ‹åŒºåŸŸå†…çš„ç©ºæ°”æ—¶ï¼Œå¤šä¼ æ„Ÿå™¨æ¨¡å—å°†å¯¹å…¶ä¸­çš„æ°”ä½“è¿›è¡Œå–æ ·ï¼Œä¿¡å·å¤„ç†æ¨¡å—å°†è¿›è¡ŒADè½¬æ¢å’Œä¸²è¡Œé€šä¿¡è¾“å…¥ï¼Œä»¥ä¾¿è¿›è¡Œç»„åˆ†æ•°æ®çš„æ•°æ®åˆ†æå’Œå¤„ç†[7]ã€‚
è½¬æ¢åçš„æ•°å­—ä¿¡å·å°†é€šè¿‡æ— çº¿é€šä¿¡æ¨¡å—ä¸Šä¼ åˆ°ç³»ç»Ÿç»ˆç«¯ï¼Œç»ˆç«¯å°†å®ç°æ•°æ®æ¥æ”¶ã€åˆ†æå’Œå¤„ç†ã€‚

3 ç¡¬ä»¶è®¾è®¡æ–¹æ¡ˆ
è¯¥è®¾è®¡çš„ç¡¬ä»¶éƒ¨åˆ†ä¸»è¦åŒ…æ‹¬å¾®æ§åˆ¶å™¨ä¸»æ§æ¨¡å—ã€é›†æˆä¼ æ„Ÿå™¨æ¨¡å—å’Œå§¿æ€ä¼ æ„Ÿæ¨¡å—ã€‚
å…¶ä¸­ï¼Œä»¥STM32ä½œä¸ºä¸»æ§ï¼Œæ§åˆ¶ç³»ç»Ÿå¯¹å¤šç»´ä¼ æ„Ÿå™¨ä¿¡å·è¿›è¡Œé‡‡é›†ï¼Œå¯¹ä»ç©ºæ°”ä¸­é‡‡æ ·çš„ä¼ æ„Ÿå™¨è¿›è¡Œé«˜é¢‘ç‡çš„é‡‡æ ·ï¼Œé’ˆå¯¹éœ€è¦å®æ—¶ç›‘æµ‹ç©ºæ°”ä¿¡å·çš„ç‰¹ç‚¹ï¼Œéœ€è¦ç¡®ä¿ä¼ æ„Ÿå™¨æ¨¡å—å’ŒADæ¨¡å—ä¿¡å·ä¼ è¾“å…·æœ‰ç›¸åŒçš„é¢‘ç‡ï¼Œä»¥å®ç°é«˜æ•ˆçš„ä¿¡å·å¤„ç†[8-9]ã€‚

At the same time, according to the 9-axis attitude angle sensor JY901 collected by the UAV operating status, to achieve multi-angle adjustment of the UAV operating attitude, the specific hardware design scheme is shown in Figure 2 below.
Figure 2: Overall hardware block diagram
å›¾2ï¼šæ•´ä½“ç¡¬ä»¶æ¡†å›¾

3.1 Main Control Module 
The main control module is mainly composed of the main control system and peripheral circuits.
Its specific functions are as follows: The main control system reads and writes the data collected by the 9- axis attitude Angle sensor JY901 through the I2C bus, and transmits it to the remote control module for display and output through the communication module.
At the same time, after receiving the adjustment signal, PWM wave can be generated and transmitted to the attitude detection and adjustment module to control the attitude of the UAV.
The concept diagram of system design and detection is shown in Figure 3 below.
ä¸æ­¤åŒæ—¶ï¼Œæ ¹æ®ç”±æ— äººæœºè¿è¡ŒçŠ¶æ€æ”¶é›†çš„9è½´å§¿æ€è§’ä¼ æ„Ÿå™¨JY901çš„æ•°æ®ï¼Œå®ç°æ— äººæœºæ“ä½œå§¿æ€çš„å¤šè§’åº¦è°ƒæ•´ï¼Œå…·ä½“çš„ç¡¬ä»¶è®¾è®¡æ–¹æ¡ˆå¦‚ä¸‹å›¾2æ‰€ç¤ºã€‚

3.1 ä¸»æ§æ¨¡å— 
ä¸»æ§æ¨¡å—ä¸»è¦ç”±ä¸»æ§ç³»ç»Ÿå’Œå¤–å›´ç”µè·¯ç»„æˆã€‚
å…¶å…·ä½“åŠŸèƒ½å¦‚ä¸‹ï¼šä¸»æ§ç³»ç»Ÿé€šè¿‡I2Cæ€»çº¿è¯»å–å’Œå†™å…¥ç”±9è½´å§¿æ€è§’ä¼ æ„Ÿå™¨JY901æ”¶é›†çš„æ•°æ®ï¼Œå¹¶é€šè¿‡é€šä¿¡æ¨¡å—å°†å…¶ä¼ è¾“ç»™é¥æ§æ¨¡å—è¿›è¡Œæ˜¾ç¤ºå’Œè¾“å‡ºã€‚
åŒæ—¶ï¼Œåœ¨æ¥æ”¶åˆ°è°ƒæ•´ä¿¡å·åï¼Œå¯ä»¥ç”ŸæˆPWMæ³¢å¹¶ä¼ è¾“ç»™å§¿æ€æ£€æµ‹å’Œè°ƒæ•´æ¨¡å—ï¼Œä»¥æ§åˆ¶æ— äººæœºçš„å§¿æ€ã€‚
ç³»ç»Ÿè®¾è®¡å’Œæ£€æµ‹çš„æ¦‚å¿µå›¾å¦‚ä¸‹å›¾3æ‰€ç¤ºã€‚

Figure 3: Diagram system design test system diagram 
å›¾3ï¼šç³»ç»Ÿè®¾è®¡æµ‹è¯•ç³»ç»Ÿå›¾ 

According to the above design requirements, STM32F103C8T6 is selected as the main control chip of the main control unit in this project.
The working frequency of the chip is 72MHz, and the FLASH register of 512KB is included inside.

Figure 4: Flow chart of MPU6050 reading data 
å›¾4ï¼šMPU6050è¯»å–æ•°æ®çš„æµç¨‹å›¾ã€‚

3.2 Attitude detection module 
For the attitude detection module is mainly through the highly integrated attitude sensor to the UAV three inclination angle and acceleration measurement, taking into account the air environment may increase the integrated sensor error, magnetometer, GPS and other attitude detection components by the interference of magnetoelectricity and affect the reliability of its detection data[10].
By comparing the basic parameters of the sensor gyroscope, the 9-axis attitude angle sensor JY901 sensor is selected as the actuator for collecting attitude data.
æ ¹æ®ä¸Šè¿°è®¾è®¡è¦æ±‚ï¼Œæœ¬é¡¹ç›®çš„ä¸»æ§å•å…ƒé€‰æ‹©äº†STM32F103C8T6ä½œä¸ºä¸»æ§èŠ¯ç‰‡ã€‚
è¯¥èŠ¯ç‰‡çš„å·¥ä½œé¢‘ç‡ä¸º72MHzï¼Œå†…éƒ¨åŒ…å«512KBçš„FLASHå¯„å­˜å™¨ã€‚

3.2å§¿æ€æ£€æµ‹æ¨¡å—
ä¸»è¦é€šè¿‡é«˜åº¦é›†æˆçš„å§¿æ€ä¼ æ„Ÿå™¨å¯¹æ— äººæœºçš„ä¸‰ä¸ªå€¾æ–œè§’åº¦å’ŒåŠ é€Ÿåº¦è¿›è¡Œæµ‹é‡ã€‚
è€ƒè™‘åˆ°ç©ºæ°”ç¯å¢ƒå¯èƒ½å¢åŠ é›†æˆä¼ æ„Ÿå™¨è¯¯å·®çš„æƒ…å†µï¼Œé€šè¿‡ç£ç”µå¹²æ‰°å½±å“é™€èºä»ªå™¨ã€GPSç­‰å§¿æ€æ£€æµ‹ç»„ä»¶ï¼Œå¯èƒ½ä¼šå½±å“å…¶æ£€æµ‹æ•°æ®çš„å¯é æ€§[10]ã€‚
é€šè¿‡æ¯”è¾ƒä¼ æ„Ÿå™¨é™€èºä»ªçš„åŸºæœ¬å‚æ•°ï¼Œé€‰æ‹©äº†9è½´å§¿æ€è§’ä¼ æ„Ÿå™¨JY901ä½œä¸ºæ”¶é›†å§¿æ€æ•°æ®çš„æ‰§è¡Œå™¨ã€‚

MPU6050 sensor with its high sensitivity meets the design requirements, while its data interface supports different baud rate output, which can realize the high frequency collection and processing of sampled data and ensure the real-time dynamic display of UAV attitude data.
Figure 4 below shows the flow chart of the MPU6050 sensor reading data.

3.3 Communication Module 
The data transmission of the STM32-based integrated UAV air monitoring system is mainly divided into two parts, namely data uploading and data receiving.
Data upload refers to uploading the collected environmental parameter data to the cloud platform via GSM module, while data reception refers to wireless communication with the UAV through the ground station to realize real-time monitoring and control of the data.

MPU6050ä¼ æ„Ÿå™¨å…·æœ‰é«˜çµæ•åº¦ï¼Œæ»¡è¶³è®¾è®¡è¦æ±‚ï¼Œè€Œå…¶æ•°æ®æ¥å£æ”¯æŒä¸åŒçš„æ³¢ç‰¹ç‡è¾“å‡ºï¼Œå¯ä»¥å®ç°é‡‡æ ·æ•°æ®çš„é«˜é¢‘ç‡é‡‡é›†å’Œå¤„ç†ï¼Œå¹¶ç¡®ä¿å®æ—¶åŠ¨æ€æ˜¾ç¤ºæ— äººæœºå§¿æ€æ•°æ®ã€‚
ä¸‹å›¾4æ˜¾ç¤ºäº†MPU6050ä¼ æ„Ÿå™¨è¯»å–æ•°æ®çš„æµç¨‹å›¾ã€‚

3.3é€šä¿¡æ¨¡å— 
åŸºäºSTM32çš„ç»¼åˆæ— äººæœºç©ºæ°”ç›‘æµ‹ç³»ç»Ÿçš„æ•°æ®ä¼ è¾“ä¸»è¦åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼Œå³æ•°æ®ä¸Šä¼ å’Œæ•°æ®æ¥æ”¶ã€‚
æ•°æ®ä¸Šä¼ æ˜¯æŒ‡é€šè¿‡GSMæ¨¡å—å°†æ”¶é›†çš„ç¯å¢ƒå‚æ•°æ•°æ®ä¸Šä¼ åˆ°äº‘å¹³å°ï¼Œè€Œæ•°æ®æ¥æ”¶æ˜¯æŒ‡é€šè¿‡åœ°é¢ç«™ä¸æ— äººæœºè¿›è¡Œæ— çº¿é€šä¿¡ï¼Œå®ç°å¯¹æ•°æ®çš„å®æ—¶ç›‘æ§å’Œæ§åˆ¶ã€‚

3.4 Attitude adjustment PID control system 
This paper presents an unmanned aircraft system based on serieslevel PID control, which uses a position controller and a speed controller working in series, the output of the outer-loop PID position controller as the expected value of the inner-loop PID speed controller, and the PWM duty cycle controlled by the output of the inner-loop PID speed controller to achieve accurate control of the UAV position and speed.
The system also includes a balance position stabilization control system, which monitors the angle between the UAV balance position and vertical direction through the MPU6050 attitude sensor, and uses a differential control system to assist the balance position stabilization control system to reduce overshoot errors.
In addition, the system includes a PID motion control system to control the speed of the UAV through proportional and integral control to maintain the stability of the UAV.
3.4 æ€åº¦è°ƒæ•´PIDæ§åˆ¶ç³»ç»Ÿ 
æœ¬æ–‡æå‡ºäº†ä¸€ä¸ªåŸºäºçº§è”PIDæ§åˆ¶çš„æ— äººæœºç³»ç»Ÿï¼Œè¯¥ç³»ç»Ÿé‡‡ç”¨ä½ç½®æ§åˆ¶å™¨å’Œé€Ÿåº¦æ§åˆ¶å™¨ä¸²è”å·¥ä½œï¼Œå°†å¤–ç¯PIDä½ç½®æ§åˆ¶å™¨çš„è¾“å‡ºä½œä¸ºå†…ç¯PIDé€Ÿåº¦æ§åˆ¶å™¨çš„æœŸæœ›å€¼ï¼Œå¹¶é€šè¿‡å†…ç¯PIDé€Ÿåº¦æ§åˆ¶å™¨è¾“å‡ºæ¥æ§åˆ¶PWMå ç©ºæ¯”ï¼Œä»¥å®ç°å¯¹æ— äººæœºä½ç½®å’Œé€Ÿåº¦çš„ç²¾ç¡®æ§åˆ¶ã€‚
è¯¥ç³»ç»Ÿè¿˜åŒ…æ‹¬ä¸€ä¸ªå¹³è¡¡ä½ç½®ç¨³å®šæ§åˆ¶ç³»ç»Ÿï¼Œé€šè¿‡MPU6050å§¿æ€ä¼ æ„Ÿå™¨ç›‘æµ‹æ— äººæœºå¹³è¡¡ä½ç½®ä¸å‚ç›´æ–¹å‘ä¹‹é—´çš„è§’åº¦ï¼Œå¹¶é‡‡ç”¨å·®åˆ†æ§åˆ¶ç³»ç»Ÿè¾…åŠ©å¹³è¡¡ä½ç½®ç¨³å®šæ§åˆ¶ç³»ç»Ÿï¼Œä»¥å‡å°è¶…è°ƒè¯¯å·®ã€‚
æ­¤å¤–ï¼Œè¯¥ç³»ç»Ÿè¿˜åŒ…æ‹¬ä¸€ä¸ªPIDè¿åŠ¨æ§åˆ¶ç³»ç»Ÿï¼Œé€šè¿‡æ¯”ä¾‹å’Œç§¯åˆ†æ§åˆ¶æ¥æ§åˆ¶æ— äººæœºçš„é€Ÿåº¦ï¼Œä»¥ä¿æŒæ— äººæœºçš„ç¨³å®šæ€§ã€‚

The application of this system in the integrated UAV air monitoring system can achieve efficient and accurate control results.
The structure of the specific carrier UAV part is shown in Figure 5 below.

(1) PID motion control system 
Path movement is integrated UAV air monitoring system for a long time need to maintain the state, in the process of carrying out the movement needs to ensure the overall UAV stability, while needing to identify their own path, in the process of path movement and will not have a change in the state of movement.
è¯¥ç³»ç»Ÿåœ¨ç»¼åˆæ— äººæœºç©ºä¸­ç›‘æµ‹ç³»ç»Ÿä¸­çš„åº”ç”¨å¯ä»¥å®ç°é«˜æ•ˆå‡†ç¡®çš„æ§åˆ¶ç»“æœã€‚
å…·ä½“è½½ä½“æ— äººæœºéƒ¨åˆ†çš„ç»“æ„å¦‚ä¸‹å›¾5æ‰€ç¤ºã€‚

Figure 5: Schematic diagram of the structure of the carrier drone part
å›¾5ï¼šè½½ä½“æ— äººæœºéƒ¨åˆ†ç»“æ„ç¤ºæ„å›¾

ï¼ˆ1ï¼‰PIDè¿åŠ¨æ§åˆ¶ç³»ç»Ÿ
è·¯å¾„ç§»åŠ¨æ˜¯ç»¼åˆæ— äººæœºç©ºä¸­ç›‘æµ‹ç³»ç»Ÿéœ€è¦é•¿æ—¶é—´ä¿æŒçš„çŠ¶æ€ï¼Œåœ¨è¿›è¡Œç§»åŠ¨è¿‡ç¨‹ä¸­éœ€è¦ç¡®ä¿æ•´ä¸ªæ— äººæœºçš„ç¨³å®šæ€§ï¼ŒåŒæ—¶éœ€è¦è¯†åˆ«è‡ªèº«è·¯å¾„ï¼Œåœ¨è·¯å¾„ç§»åŠ¨è¿‡ç¨‹ä¸­ä¸ä¼šå‘ç”ŸçŠ¶æ€å˜åŒ–ã€‚

 ğ‘ˆğ‘‘ = ğ¾ğ‘ƒ 2 Â· ğ‘’ (ğ‘£) (1) 
where ğ¾ğ‘ƒ : the speed proportionality constant of this part of the PI control system And then given that the motion state and tendency do not change during the path operation, so it does not bring a large fluctuation value during the operation, the system expectation deviation only depends on the external environmental factors, the system input side to introduce integral control to reduce the steady-state error, then.
ğ‘¡ âˆ« 0 where ğ¾ğ‘– : the integration constant of the speed system controller.
From the above calculations can be obtained in this control system, the control system stability of the PI control system stability logic block diagram is shown in Figure 6, whereğ‘‰ğ¿ ,ğ‘‰ğ‘… are the left and right motor speed values obtained from the coded data sensor monitoring.
ğ‘ˆğ‘‘ = ğ¾ğ‘ƒ 2 Â· ğ‘’ (ğ‘£) (1)
æ ¹æ®ä¸Šè¿°å…¬å¼ï¼Œğ‘ˆğ‘‘è¡¨ç¤ºä¸º ğ¾ğ‘ƒ ä¹˜ä»¥ ğ‘’ çš„å¹³æ–¹ï¼Œå…¶ä¸­ ğ¾ğ‘ƒ æ˜¯ PI æ§åˆ¶ç³»ç»Ÿçš„é€Ÿåº¦æ¯”ä¾‹å¸¸æ•°ã€‚
æ¥ç€ï¼Œç”±äºåœ¨è·¯å¾„è¿è¡Œè¿‡ç¨‹ä¸­è¿åŠ¨çŠ¶æ€å’Œè¶‹åŠ¿ä¸å‘ç”Ÿå˜åŒ–ï¼Œå› æ­¤åœ¨æ“ä½œè¿‡ç¨‹ä¸­ä¸ä¼šå¸¦æ¥å¤§çš„æ³¢åŠ¨å€¼ï¼Œç³»ç»ŸæœŸæœ›åå·®ä»…å–å†³äºå¤–éƒ¨ç¯å¢ƒå› ç´ ï¼Œç³»ç»Ÿè¾“å…¥ç«¯å¼•å…¥ç§¯åˆ†æ§åˆ¶ä»¥å‡å°ç¨³æ€è¯¯å·®ã€‚
ğ‘¡ âˆ« 0 
è¿™é‡Œï¼Œğ¾ğ‘– æ˜¯é€Ÿåº¦ç³»ç»Ÿæ§åˆ¶å™¨çš„ç§¯åˆ†å¸¸æ•°ã€‚
é€šè¿‡ä»¥ä¸Šè®¡ç®—ï¼Œå¯ä»¥å¾—åˆ°æ§åˆ¶ç³»ç»Ÿçš„ç¨³å®šæ€§é€»è¾‘é˜»æ­¢å›¾å¦‚å›¾ 6 æ‰€ç¤ºï¼Œå…¶ä¸­ ğ‘‰ğ¿ å’Œ ğ‘‰ğ‘… æ˜¯ä»ç¼–ç æ•°æ®ä¼ æ„Ÿå™¨ç›‘æµ‹åˆ°çš„å·¦ä¾§å’Œå³ä¾§ç”µæœºé€Ÿåº¦å€¼ã€‚

 ğ‘ˆğ‘‘ = ğ¾ğ‘– ğ‘’ (ğ‘£) dğ‘¡ (2) 
 
This PI control system regulates the speed of the integrated UAV air monitoring system by superimposing the drive voltage obtained from the initial speed of the input quantity through proportional and integral operations, and then converting it into the duty cycle of the PWM control signal through the master control system.
(2) Balance position stability control system 
In this project, the angle between the UAV balance position and the vertical direction is monitored by the MPU6050 attitude sensor.
When the integrated UAV air monitoring system is tilted due to motion and external human factors, the rotor assumes clockwise rotation and the rotor is then subjected to reverse torque F, causing the UAS to tilt.
For a smaller tilt, a motor drive module is required to provide recovery force to the balance drive motor ğ¹1 to keep the UAV upright.


Closed loop Motor EM1 Speed ring Motor EM2 Speed ring Motor EM3 Speed ring Motor EM4 Speed ring P 3.374 3.4842 3.152 3.1231 I 3.5162 3.4120 3.601 3.5124 D 0.0179 0.0181 0.0165 0.
ğ‘ˆğ‘‘ = ğ¾ğ‘– ğ‘’ (ğ‘£) dğ‘¡ (2) 

è¿™ä¸ªPIæ§åˆ¶ç³»ç»Ÿé€šè¿‡æ¯”ä¾‹å’Œç§¯åˆ†è¿ç®—å°†è¾“å…¥é‡çš„åˆé€Ÿåº¦å¾—åˆ°çš„é©±åŠ¨ç”µå‹å åŠ ï¼Œç„¶åé€šè¿‡ä¸»æ§åˆ¶ç³»ç»Ÿå°†å…¶è½¬æ¢ä¸ºPWMæ§åˆ¶ä¿¡å·çš„å ç©ºæ¯”ï¼Œä»è€Œè°ƒèŠ‚é›†æˆçš„æ— äººæœºç©ºæ°”ç›‘æµ‹ç³»ç»Ÿçš„é€Ÿåº¦ã€‚
(2) å¹³è¡¡ä½ç½®ç¨³å®šæ§åˆ¶ç³»ç»Ÿ
åœ¨è¿™ä¸ªé¡¹ç›®ä¸­ï¼Œé€šè¿‡MPU6050å§¿æ€ä¼ æ„Ÿå™¨ç›‘æµ‹æ— äººæœºå¹³è¡¡ä½ç½®ä¸å‚ç›´æ–¹å‘ä¹‹é—´çš„è§’åº¦ã€‚
å½“é›†æˆçš„æ— äººæœºç©ºæ°”ç›‘æµ‹ç³»ç»Ÿç”±äºè¿åŠ¨å’Œå¤–éƒ¨äººä¸ºå› ç´ å€¾æ–œæ—¶ï¼Œæ—‹ç¿¼ä¼šäº§ç”Ÿé¡ºæ—¶é’ˆæ—‹è½¬ï¼Œå¹¶ä¸”æ—‹ç¿¼ä¼šå—åˆ°åå‘æ‰­çŸ©Fçš„ä½œç”¨ï¼Œå¯¼è‡´æ— äººæœºå€¾æ–œã€‚
ä¸ºäº†å‡å°å€¾æ–œï¼Œéœ€è¦ä¸€ä¸ªç”µæœºé©±åŠ¨æ¨¡å—æ¥ä¸ºå¹³è¡¡é©±åŠ¨ç”µæœº ğ¹1 æä¾›æ¢å¤åŠ›ï¼Œä»¥ä¿æŒæ— äººæœºç›´ç«‹ã€‚

Figure 6: Design of PI control system for linear motion
å›¾6ï¼šçº¿æ€§è¿åŠ¨PIæ§åˆ¶ç³»ç»Ÿè®¾è®¡
Table 1: PID coefficient setting table
è¡¨1ï¼šPIDç³»æ•°è®¾ç½®è¡¨

é—­ç¯ ç”µæœºEM1é€Ÿåº¦ç¯ ç”µæœºEM2é€Ÿåº¦ç¯ ç”µæœºEM3é€Ÿåº¦ç¯ ç”µæœºEM4é€Ÿåº¦ç¯

P 3.374 3.4842 3.152 3.1231 I 3.5162 3.4120 3.601 3.5124 D 0.0179 0.0181 0.0165 0.
01846 

The repulsion force provided by the motor drive is proportional to the maximum tilt deviation during tilting of the device, which is related to: 
ğ¹1 = ğ¾ğ‘ƒ Â· ğ‘’ (ğœƒ ) (3) 
where ğ¾ğ‘ƒ  is the proportionality constant of the equilibrium position stabilized proportional differential control system.
01846 

ç”µæœºé©±åŠ¨æä¾›çš„æ’æ–¥åŠ›ä¸è®¾å¤‡å€¾æ–œè¿‡ç¨‹ä¸­çš„æœ€å¤§å€¾æ–œåå·®æˆæ­£æ¯”ï¼Œä¸ä»¥ä¸‹ç›¸å…³ï¼šğ¹1 = ğ¾ğ‘ƒ Â· ğ‘’ (ğœƒ ) (3)ï¼Œå…¶ä¸­ ğ¾ğ‘ƒ æ˜¯ä¿æŒå¹³è¡¡çš„æ¯”ä¾‹å¾®åˆ†æ§åˆ¶ç³»ç»Ÿçš„æ¯”ä¾‹å¸¸æ•°ã€‚

However, when the system receives a large external influence, resulting in a large error in the drive voltage and desired torque, it will make the system reply force applied lagging resulting in a large overshoot error, in this part of the design using differential D control system, so that it introduces a damping force proportional to the speed and desired torque and opposite to the reply force ğ¹ğ‘“ 2 
That is: ğ¹ğ‘“ = ğ¾ğ‘‘ dğ‘’ (ğœƒ ) dğ‘¡ (4) 
where ğ¾ğ‘‘  is the differential constant of the equilibrium position stabilized PD control system.
Thus there is: ğ¹2 = F + ğ¹ğ‘“ = ğ¾ğ‘ƒ Â· ğ‘’ (ğœƒ ) + ğ¾ğ‘‘ dğ‘’ (ğœƒ ) dğ‘¡ (5) 
The timing system control period set by the system module is 20ms.
after system modeling and several practical tests, the PID coefficients finally selected for this system are shown in Table 1, where the left and right motors are driven at different times and torques for stabilization, straight ahead and steering, and the corresponding coefficients are set respectively.

ç„¶è€Œï¼Œå½“ç³»ç»Ÿå—åˆ°å¤§çš„å¤–éƒ¨å½±å“æ—¶ï¼Œé©±åŠ¨ç”µå‹å’ŒæœŸæœ›æ‰­çŸ©å‡ºç°è¾ƒå¤§è¯¯å·®ï¼Œç³»ç»Ÿä¼šäº§ç”Ÿæ»åçš„å“åº”åŠ›ï¼Œå¯¼è‡´è¾ƒå¤§çš„è¶…è°ƒè¯¯å·®ï¼Œåœ¨è®¾è®¡çš„è¿™ä¸€éƒ¨åˆ†ä¸­ä½¿ç”¨å·®åˆ†Dæ§åˆ¶ç³»ç»Ÿï¼Œä½¿å…¶å¼•å…¥ä¸é€Ÿåº¦å’ŒæœŸæœ›æ‰­çŸ©æˆæ¯”ä¾‹ä¸”ä¸å“åº”åŠ›ç›¸åçš„é˜»å°¼åŠ›ğ¹ğ‘“ã€‚
å³ï¼šğ¹ğ‘“ = ğ¾ğ‘‘ dğ‘’ (ğœƒ ) / dğ‘¡ (4)ï¼Œå…¶ä¸­ğ¾ğ‘‘æ˜¯å¹³è¡¡ä½ç½®ç¨³å®šPDæ§åˆ¶ç³»ç»Ÿçš„å·®åˆ†å¸¸æ•°ã€‚
å› æ­¤æœ‰ï¼šğ¹2 = F + ğ¹ğ‘“ = ğ¾ğ‘ƒ Â· ğ‘’ (ğœƒ ) + ğ¾ğ‘‘ dğ‘’ (ğœƒ ) / dğ‘¡ (5)ã€‚
ç³»ç»Ÿæ¨¡å—è®¾ç½®çš„å®šæ—¶æ§åˆ¶å‘¨æœŸä¸º20æ¯«ç§’ã€‚
ç»è¿‡ç³»ç»Ÿå»ºæ¨¡å’Œå¤šæ¬¡å®é™…æµ‹è¯•ï¼Œæœ€ç»ˆé€‰æ‹©äº†è¯¥ç³»ç»Ÿçš„PIDç³»æ•°å¦‚è¡¨1æ‰€ç¤ºï¼Œå…¶ä¸­å·¦å³ç”µæœºåœ¨ä¸åŒæ—¶é—´å’Œæ‰­çŸ©ä¸‹ç”¨äºç¨³å®šã€ç›´è¡Œå’Œè½¬å‘ï¼Œå¹¶åˆ†åˆ«è®¾ç½®äº†ç›¸åº”çš„ç³»æ•°ã€‚

3.5 Overall software design 
The system threshold is set according to the normal value range of different assessment indexes, which is achieved by setting the criteria of different assessment indexes.
CO and SO2 are used as pollution gas detection objects, and the alarm threshold of the system is set to 30010-6.
When the gas volume fraction reaches 10010-6, the system starts to detect the presence of pollution gas and displays the pollution gas concentration information at the terminal display in real time; when the pollution gas volume fraction exceeds 30010-6, the alarm light starts to light up and the data is prompted by GSM communication The data is stored.
The following figure shows the display and alarm of the terminal in the simulated situation.

å›¾7ï¼šä¸Šä½æœºç¨‹åºçš„å—å›¾è®¾è®¡
Figure 7: Block diagram design of the upper computer program

3.5æ•´ä½“è½¯ä»¶è®¾è®¡
ç³»ç»Ÿé˜ˆå€¼æ ¹æ®ä¸åŒè¯„ä¼°æŒ‡æ ‡çš„æ­£å¸¸å€¼èŒƒå›´æ¥è®¾ç½®ï¼Œè¿™æ˜¯é€šè¿‡è®¾ç½®ä¸åŒçš„è¯„ä¼°æŒ‡æ ‡çš„æ ‡å‡†æ¥å®ç°çš„ã€‚
COå’ŒSO2è¢«ç”¨ä½œæ±¡æŸ“æ°”ä½“æ£€æµ‹å¯¹è±¡ï¼Œç³»ç»Ÿçš„æŠ¥è­¦é˜ˆå€¼è®¾ç½®ä¸º30010-6ã€‚
ä¸‹å›¾æ˜¾ç¤ºäº†æ¨¡æ‹Ÿæƒ…å†µä¸‹ç»ˆç«¯çš„æ˜¾ç¤ºå’ŒæŠ¥è­¦æƒ…å†µã€‚

The interactive interface of the terminal can display the current fluctuation of the pollutant gas, and the line graph can clearly show the change of the pollutant gas concentration in different areas during the air detection process.
The specific monitoring interface is shown in Figure 7.
As can be seen from Figure 8 below, in order to ensure the normal communication between the upper computer and the lower computer, we first need to configure the VISA protocol and the 
serial port control, and set the corresponding parameters, including
baud rate, serial port number, number of bits sent, stop bit and
parity bit. At the same time, in order to improve the stability of
the serial port reading data, each time the program is executed,
the above parameters are assigned initial values. The serial port
read control needs to be configured to set the number of accepted
bytes to 8 bits in order to receive the value of int type sent by the
microcontroller. Finally, the read data is stored in the read buffer
and output to the next link.
ç»ˆç«¯çš„äº¤äº’ç•Œé¢å¯ä»¥æ˜¾ç¤ºæ±¡æŸ“æ°”ä½“çš„å½“å‰æ³¢åŠ¨ï¼Œå¹¶ä¸”æŠ˜çº¿å›¾å¯ä»¥æ¸…æ¥šåœ°å±•ç¤ºç©ºæ°”æ£€æµ‹è¿‡ç¨‹ä¸­ä¸åŒåŒºåŸŸå†…æ±¡æŸ“æ°”ä½“æµ“åº¦çš„å˜åŒ–ã€‚
å…·ä½“çš„ç›‘æµ‹ç•Œé¢å¦‚å›¾7æ‰€ç¤ºã€‚
ä»ä¸‹é¢çš„å›¾8å¯ä»¥çœ‹å‡ºï¼Œä¸ºäº†ç¡®ä¿ä¸Šä½æœºå’Œä¸‹ä½æœºä¹‹é—´çš„æ­£å¸¸é€šä¿¡ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦é…ç½®VISAåè®®å’Œä¸²å£æ§åˆ¶ï¼Œå¹¶è®¾ç½®ç›¸åº”çš„å‚æ•°ï¼ŒåŒ…æ‹¬æ³¢ç‰¹ç‡ã€ä¸²å£å·ã€å‘é€æ¯”ç‰¹æ•°ã€åœæ­¢ä½å’Œå¥‡å¶æ ¡éªŒä½ã€‚åŒæ—¶ï¼Œä¸ºäº†æé«˜ä¸²å£è¯»å–æ•°æ®çš„ç¨³å®šæ€§ï¼Œåœ¨æ¯æ¬¡ç¨‹åºæ‰§è¡Œæ—¶ï¼Œä»¥ä¸Šå‚æ•°è¢«èµ‹äºˆåˆå§‹å€¼ã€‚ä¸²å£è¯»å–æ§åˆ¶éœ€è¦é…ç½®ä»¥æ¥æ”¶intç±»å‹ç”±å¾®æ§åˆ¶å™¨å‘é€çš„å€¼ï¼Œå°†æ¥å—å­—èŠ‚æ•°è®¾ç½®ä¸º8ä¸ªæ¯”ç‰¹ã€‚æœ€åï¼Œè¯»å–åˆ°çš„æ•°æ®å­˜å‚¨åœ¨è¯»ç¼“å†²åŒºä¸­å¹¶è¾“å‡ºåˆ°ä¸‹ä¸€ä¸ªè¿æ¥ç‚¹ã€‚

4 SYSTEM VALIDATION
Through system design, monitoring parameters can be selected
according to actual requirements, such as TSP, PM2.5, PM10 and
other particulate matter parameters and CO, O 3 , SO 2 , NO 2 , VOC
and other gas parameters. Meanwhile, STM32â€™s integrated UAV air
monitoring system can detect height, location, pollutant distribu-
tion concentration and other data. At the same time, the monitoring
system is convenient in operation, accurate in measurement, reli-
able in operation, light in volume and small in size, which provides
an effective monitoring means for the analysis of air quality in three-
dimensional space. The implementation scheme of this system is
shown in Figure 9(left). First, the designated monitoring area is se-
lected and the pollution gas is monitored by the monitoring system
carried by the UAV. The monitoring data is transmitted wirelessly
through the GSM communication system to ensure the stability,
accuracy and real-time performance of the system transmission.
4 ç³»ç»ŸéªŒè¯
é€šè¿‡ç³»ç»Ÿè®¾è®¡ï¼Œå¯ä»¥æ ¹æ®å®é™…éœ€æ±‚é€‰æ‹©ç›‘æµ‹å‚æ•°ï¼Œå¦‚TSPã€PM2.5ã€PM10å’Œå…¶ä»–é¢—ç²’ç‰©å‚æ•°ä»¥åŠCOã€O3ã€SO2ã€NO2ã€VOCç­‰æ°”ä½“å‚æ•°ã€‚åŒæ—¶ï¼ŒSTM32é›†æˆçš„æ— äººæœºç©ºæ°”ç›‘æµ‹ç³»ç»Ÿå¯ä»¥æ£€æµ‹é«˜åº¦ã€ä½ç½®ã€æ±¡æŸ“ç‰©åˆ†å¸ƒæµ“åº¦ç­‰æ•°æ®ã€‚åŒæ—¶ï¼Œè¯¥ç›‘æµ‹ç³»ç»Ÿæ“ä½œæ–¹ä¾¿ï¼Œæµ‹é‡å‡†ç¡®å¯é ï¼Œåœ¨ä½“ç§¯ä¸Šè½»å·§å°å·§ï¼Œä¸ºä¸‰ç»´ç©ºé—´å†…çš„ç©ºæ°”è´¨é‡åˆ†ææä¾›äº†æœ‰æ•ˆçš„ç›‘æµ‹æ‰‹æ®µã€‚è¯¥ç³»ç»Ÿçš„å®æ–½æ–¹æ¡ˆå¦‚å›¾9ï¼ˆå·¦ï¼‰æ‰€ç¤ºã€‚é¦–å…ˆé€‰æ‹©æŒ‡å®šçš„ç›‘æµ‹åŒºåŸŸï¼Œå¹¶ç”±æ— äººæœºæºå¸¦çš„ç›‘æµ‹ç³»ç»Ÿå¯¹æ±¡æŸ“æ°”ä½“è¿›è¡Œç›‘æµ‹ã€‚é€šè¿‡GSMé€šä¿¡ç³»ç»Ÿå°†ç›‘æµ‹æ•°æ®æ— çº¿ä¼ è¾“ï¼Œä»¥ç¡®ä¿ç³»ç»Ÿä¼ è¾“çš„ç¨³å®šæ€§ã€å‡†ç¡®æ€§å’Œå®æ—¶æ€§ã€‚

In the PC terminal design the upper computer to receive the
transmission signal, through the threshold value of the system
selected to achieve the monitoring of the normal value of different
assessment indicators, while in the PC terminal will be different
regions and height of the air pollution situation through the graph to display, the system specific monitoring effect is shown in Figure 9(right).
åœ¨PCç»ˆç«¯è®¾è®¡ä¸­ï¼Œä¸Šä½æœºæ¥æ”¶ä¼ è¾“ä¿¡å·ï¼Œé€šè¿‡ç³»ç»Ÿé€‰æ‹©çš„é˜ˆå€¼å®ç°å¯¹ä¸åŒè¯„ä¼°æŒ‡æ ‡æ­£å¸¸å€¼çš„ç›‘æµ‹ã€‚åŒæ—¶ï¼Œåœ¨PCç»ˆç«¯ä¸Šé€šè¿‡å›¾è¡¨æ˜¾ç¤ºä¸åŒåœ°åŒºå’Œé«˜åº¦çš„ç©ºæ°”æ±¡æŸ“æƒ…å†µï¼Œå…·ä½“ç›‘æµ‹æ•ˆæœå¦‚å›¾9ï¼ˆå³ä¾§ï¼‰æ‰€ç¤ºã€‚


5 CONCLUSION 
This paper designs an integrated pollution and air monitoring system based on STM32 according to the current air detection problems.
The system designs an integrated multi-pollution index air monitoring system, which can complete the high-precision detection of a variety of air pollution gases.
By carrying the air detection system on the UAV, the monitoring of air pollution at different heights can be realized with high flexibility and stability.
The detected data of different air pollution indicators can be transmitted to the PC through the wireless transmission system.
It can be visually converted into a two-dimensional graph for analysis and processing.
The curve of air pollution gas concentration change after treatment can be viewed in the remote computer upper computer.
The recent fluctuation of pollution gas concentration can be viewed through the terminal upper computer and the current type and specific concentration of pollution gas can be displayed at the same time, which has a good application prospect.

5 ç»“è®º
æœ¬æ–‡æ ¹æ®å½“å‰çš„ç©ºæ°”æ£€æµ‹é—®é¢˜ï¼Œè®¾è®¡äº†ä¸€ç§åŸºäºSTM32çš„ç»¼åˆæ±¡æŸ“å’Œç©ºæ°”ç›‘æµ‹ç³»ç»Ÿã€‚
è¯¥ç³»ç»Ÿè®¾è®¡äº†ä¸€ä¸ªç»¼åˆå¤šæ±¡æŸ“æŒ‡æ•°ç©ºæ°”ç›‘æµ‹ç³»ç»Ÿï¼Œå¯ä»¥å¯¹å¤šç§ç©ºæ°”æ±¡æŸ“æ°”ä½“è¿›è¡Œé«˜ç²¾åº¦æ£€æµ‹ã€‚
é€šè¿‡å°†ç©ºæ°”æ£€æµ‹ç³»ç»Ÿæ­è½½åœ¨æ— äººæœºä¸Šï¼Œå¯ä»¥å®ç°å¯¹ä¸åŒé«˜åº¦çš„ç©ºæ°”æ±¡æŸ“è¿›è¡Œé«˜åº¦çµæ´»å’Œç¨³å®šçš„ç›‘æµ‹ã€‚
ä¸åŒç©ºæ°”æ±¡æŸ“æŒ‡æ ‡çš„æ£€æµ‹æ•°æ®å¯ä»¥é€šè¿‡æ— çº¿ä¼ è¾“ç³»ç»Ÿä¼ è¾“åˆ°ç”µè„‘ä¸Šã€‚
å¯ä»¥å°†å…¶å¯è§†åŒ–ä¸ºäºŒç»´å›¾è¿›è¡Œåˆ†æå’Œå¤„ç†ã€‚
æ²»ç†åçš„ç©ºæ°”æ±¡æŸ“æ°”ä½“æµ“åº¦å˜åŒ–æ›²çº¿å¯ä»¥åœ¨è¿œç¨‹ç”µè„‘ä¸ŠæŸ¥çœ‹ã€‚
é€šè¿‡ç»ˆç«¯ä¸Šä½æœºå¯ä»¥æŸ¥çœ‹æ±¡æŸ“æ°”ä½“æµ“åº¦çš„è¿‘æœŸæ³¢åŠ¨ï¼Œå¹¶åŒæ—¶æ˜¾ç¤ºå½“å‰æ±¡æŸ“æ°”ä½“çš„ç±»å‹å’Œå…·ä½“æµ“åº¦ï¼Œå…·æœ‰å¹¿é˜”çš„åº”ç”¨å‰æ™¯ã€‚

ACKNOWLEDGMENTS 
This research was supported by Independent Innovation Research Fund Project of Wuhan University of Technology (Fund number: 236805007) 
é‰´è°¢
æœ¬ç ”ç©¶å¾—åˆ°äº†æ­¦æ±‰ç†å·¥å¤§å­¦è‡ªä¸»åˆ›æ–°ç ”ç©¶åŸºé‡‘é¡¹ç›®çš„æ”¯æŒï¼ˆåŸºé‡‘ç¼–å·ï¼š236805007ï¼‰ã€‚

REFERENCES 
[1] WANG Shiyu.
Research on Information Collection and Trajectory Planning Strategy of UAV Based on Aerodynamics [J].
Beijing university of posts and telecommunications, 2021.
[2] XU X L.
Design and implementation of air quality detection system based on UAV [J].
Xiking school, 2020.
[3] YAO X M.
Real-time monitoring technology and system of air CO2 concentra- tion based on unmanned aerial vehicle [J].
Northwest agriculture and forestry university of science and technology, 2020.
[4] Xie L H.
Air Pollution source location technology and experimental research based on unmanned aerial vehicle [J].
China university of measurement, 2020.
[5] XIE Tao.
Design of Multi-parameter Air Quality Detection System Based on Four-rotor UAV [J].
Anhui University of Science and Technology,2019.


å‚è€ƒæ–‡çŒ®
[1] ç‹ä¸–å®‡ã€‚
åŸºäºç©ºæ°”åŠ¨åŠ›å­¦çš„æ— äººæœºä¿¡æ¯é‡‡é›†ä¸è½¨è¿¹è§„åˆ’ç­–ç•¥ç ”ç©¶[J]ã€‚
åŒ—äº¬é‚®ç”µå¤§å­¦ï¼Œ2021ã€‚

[2] å¾æ™“äº®ã€‚
åŸºäºæ— äººæœºçš„ç©ºæ°”è´¨é‡æ£€æµ‹ç³»ç»Ÿè®¾è®¡ä¸å®ç°[J]ã€‚
è¥¿äº¬å­¦æ ¡ï¼Œ2020ã€‚

[3] å§šç§€æ¢…ã€‚
åŸºäºæ— äººæœºçš„ç©ºæ°”CO2æµ“åº¦å®æ—¶ç›‘æµ‹æŠ€æœ¯ä¸ç³»ç»Ÿ[J]ã€‚
è¥¿åŒ—å†œæ—ç§‘æŠ€å¤§å­¦ï¼Œ2020ã€‚

[4] è°¢ç«‹è¾‰ã€‚
åŸºäºæ— äººæœºçš„ç©ºæ°”æ±¡æŸ“æºå®šä½æŠ€æœ¯åŠå®éªŒç ”ç©¶[J]ã€‚
ä¸­å›½è®¡é‡å¤§å­¦ï¼Œ2020ã€‚

[5] è°¢æ¶›ã€‚
åŸºäºå››æ—‹ç¿¼æ— äººæœºçš„å¤šå‚æ•°ç©ºæ°”è´¨é‡æ£€æµ‹ç³»ç»Ÿè®¾è®¡[J]ã€‚
å®‰å¾½ç§‘æŠ€å­¦é™¢ï¼Œ2019ã€‚

[6] Chen H S.
Research and application of PM_ (2.5) and its precursors concentration monitoring system based on UAV [J].
China university of measurement, 2019.
[7] YAN Fenfen.
Research and Design of Environmental Air Detection Device based on quadrotor aircraft [J].
Tianjin University of Technology,2016.
[8] LIU W F.
Application of real-time database in air quality automatic monitoring system [J].
Huazhong University of Science and Technology,2015.
[9] DENG Tuo.
Design of Wireless Sensor Network for Indoor Air Monitoring [J].
Wuhan University of Technology,2015.
[10] Yu Kesheng.
Research on Indoor Air Monitoring System Based on Embedded Linux [J].
Huazhong University of Science and Technology,2013.
Figure 8: Serial port reading serial port control, and set the corresponding parameters, including baud rate, serial port number, number of bits sent, stop bit and parity bit.
At the same time, in order to improve the stability of the serial port reading data, each time the program is executed, the above parameters are assigned initial values.

[6] é™ˆæ´ªç”Ÿã€‚
åŸºäºæ— äººæœºçš„PM_ï¼ˆ2.5ï¼‰åŠå…¶å‰ä½“æµ“åº¦ç›‘æµ‹ç³»ç»Ÿçš„ç ”ç©¶ä¸åº”ç”¨ [J]ã€‚
ä¸­å›½è®¡é‡å¤§å­¦ï¼Œ2019å¹´ã€‚
[7] é—«èŠ¬èŠ¬ã€‚
åŸºäºå››æ—‹ç¿¼é£è¡Œå™¨çš„ç¯å¢ƒç©ºæ°”æ£€æµ‹è£…ç½®çš„ç ”ç©¶ä¸è®¾è®¡[J]ã€‚
å¤©æ´¥ç†å·¥å¤§å­¦ï¼Œ2016å¹´ã€‚
[8] åˆ˜ä¼Ÿå³°ã€‚
å®æ—¶æ•°æ®åº“åœ¨ç©ºæ°”è´¨é‡è‡ªåŠ¨ç›‘æµ‹ç³»ç»Ÿä¸­çš„åº”ç”¨[J]ã€‚
åä¸­ç§‘æŠ€å¤§å­¦ï¼Œ2015å¹´ã€‚
[9] é‚“æ‹“ã€‚
å®¤å†…ç©ºæ°”ç›‘æµ‹æ— çº¿ä¼ æ„Ÿå™¨ç½‘ç»œçš„è®¾è®¡[J]ã€‚
æ­¦æ±‰ç†å·¥å¤§å­¦ï¼Œ2015å¹´ã€‚
[10] äºå…‹èƒœã€‚
åŸºäºåµŒå…¥å¼Linuxçš„å®¤å†…ç©ºæ°”ç›‘æµ‹ç³»ç»Ÿç ”ç©¶[J]ã€‚
åä¸­ç§‘æŠ€å¤§å­¦ï¼Œ2013å¹´ã€‚

